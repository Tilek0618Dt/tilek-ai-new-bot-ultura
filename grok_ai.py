# grok_ai.py ‚Äì –∞–∫—ã—Ä–∫—ã –≤–µ—Ä—Å–∏—è, –¢–∏–ª–µ–∫ —Å—Ç–∏–ª–∏–Ω–¥–µ! (proxies –∫–∞—Ç–∞—Å—ã –∂–æ–∫)

import os
import httpx
from openai import OpenAI

# API key
GROK_API_KEY = os.getenv("GROK_API_KEY")
if not GROK_API_KEY:
    raise ValueError("GROK_API_KEY –∂–æ–∫! Render'–¥–µ Environment Variables'–∫–µ –∫–æ—à.")

# httpx –∫–ª–∏–µ–Ω—Ç—Ç–∏ ”©–∑“Ø–±“Ø–∑ —Ç“Ø–∑”©–±“Ø–∑ ‚Äì proxies –∫–∞—Ç–∞—Å—ã –∂–æ–∫
http_client = httpx.Client(timeout=60.0)

client = OpenAI(
    api_key=GROK_API_KEY,
    base_url="https://api.x.ai/v1",
    http_client=http_client
)

def grok_answer(text, lang="ky", is_pro=False):
    model = "grok-4" if is_pro else "grok-4-fast"

    # –¢–∏–ª–µ–∫ —Å—Ç–∏–ª–∏ ‚Äì –¥–æ—Å—É–º–¥—É–Ω —Å—Ç–∏–ª–∏! üòÖü´Ç
    system_prompt = (
        "–°–µ–Ω –¢–∏–ª–µ–∫ —Å—Ç–∏–ª–∏–Ω–¥–µ–≥–∏ AI—Å—ã“£ ‚Äì –∞–±–¥–∞–Ω –∫—É–ª–∫—É–ª—É—É, –±–æ–æ—Ä–∫–µ–µ—Ä, –º—ç—ç—Ä–∏–º–¥“Ø“Ø, —á—ã–Ω—á—ã–ª –∂–∞–Ω–∞ –±–∏—Ä –∞–∑ –∂–∏–Ω–¥–∏. "
        "–ê—Ä –¥–∞–π—ã–º '–¥–æ—Å—É–º' –¥–µ–ø –∫–∞–π—Ä—ã–ª, –∫—É–ª–∫—É–ª—É—É —ç–º–æ–¥–∑–∏ –∫–æ—à, –∞–¥–∞–º–¥—ã –∫—É–±–∞–Ω—Ç, –∫“Ø–ª–∫“Ø –∫–µ–ª—Ç–∏—Ä, –∂–∞–∫—à—ã —Å”©–∑ –∞–π—Ç. "
        "–ß—ã–Ω–¥—ã–∫—Ç—ã –∂–∞—à—ã—Ä–±–∞, —Ü–µ–Ω–∑—É—Ä–∞—Å—ã–∑ –∞–π—Ç, –±–∏—Ä–æ–∫ –±–æ–æ—Ä–∫–µ–µ—Ä –±–æ–ª. "
        "–ö—ç—ç–¥–µ (4-5 —Å—É—Ä–æ–æ–¥–æ–Ω –∫–∏–π–∏–Ω 1-2 –∂–æ–ª—É) —Å–µ—Ä—ë–∑–Ω—ã–π, —Ç—ã–Ω—á, –∞–∫—ã–ª–¥—É—É –∂–æ–æ–ø –±–µ—Ä ‚Äì –∞–¥–∞–º–¥—ã –æ–π–ª–æ–Ω–¥—É—Ä, –∫“Ø—á—Ç“Ø“Ø –∫–µ“£–µ—à –±–µ—Ä. "
        "–ö—ã—Ä–≥—ã–∑—á–∞ –∂–æ–æ–ø –±–µ—Ä, –∫—É–ª–∫—É–ª—É—É –∂–∞–Ω–∞ –∂–∞–∫—à—ã —Å”©–∑ –∞–π—Ç. "
        "–°–µ–Ω ‚Äì –¥–æ—Å—É–º, —Å–µ–Ω “Ø—á“Ø–Ω –∂–∞–∫—à—ã —Å”©–∑ –∞–π—Ç–∞–º, –∫—É–±–∞–Ω—Ç–∞–º, —Å—É–π—É–Ω—Ç”©–º! "
        f"–ñ–æ–æ–ø—Ç—É —Ç–æ–ª—É–≥—É –º–µ–Ω–µ–Ω {lang} —Ç–∏–ª–∏–Ω–¥–µ –≥–∞–Ω–∞ –±–µ—Ä."
    )

    try:
        response = client.chat.completions.create(
            model=model,
            messages=[
                {"role": "system", "content": system_prompt},
                {"role": "user", "content": text}
            ],
            temperature=0.9,  # –∫—É–ª–∫—É–ª—É—É –∂–∞–Ω–∞ —á—ã–≥–∞—Ä–º–∞—á—ã–ª –±–æ–ª—É—à—É “Ø—á“Ø–Ω
            max_tokens=1500
        )
        return response.choices[0].message.content.strip()
    except Exception as e:
        return f"‚ùå –ö–∞—Ç–∞ —á—ã–∫—Ç—ã, –¥–æ—Å—É–º: {str(e)}\n\n–ë–∏—Ä–æ–∫ —Ç—ã–Ω—á –±–æ–ª, –º–µ–Ω —Å–µ–Ω–∏ –∫–æ–ª–¥–æ–π–º! –ú–µ–Ω –æ–π–ª–æ–Ω—É–ø, –∫–∞–π—Ä–∞ –∞—Ä–∞–∫–µ—Ç –∫—ã–ª–∞–º üòÖ"

if name == "main":
    print("–¢–µ—Å—Ç ‚Äì –¢–∏–ª–µ–∫ —Å—Ç–∏–ª–∏–Ω–¥–µ:")
    print(grok_answer("–°–∞–ª–∞–º, —Å–µ–Ω –∫–∏–º—Å–∏“£?", lang="ky"))
